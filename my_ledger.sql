-- 创建数据库 my_ledger 如果它不存在
CREATE DATABASE IF NOT EXISTS my_ledger;

-- 使用刚创建或已存在的数据库 my_ledger
USE my_ledger;

-- 设置字符集为 utf8mb4 以支持更多的字符
SET NAMES utf8mb4;

-- 暂时禁用外键检查以避免删除表时出现错误
SET FOREIGN_KEY_CHECKS = 0;

-- 删除 user 表如果它存在
DROP TABLE IF EXISTS `user`;

-- 创建 user 表用于存储用户信息
CREATE TABLE `user`
(
    -- 主键 id 自动递增
    `id`         INT                           NOT NULL AUTO_INCREMENT,
    -- 用户名 最大长度为 50 的字符串 必须唯一
    `username`   VARCHAR(50) CHARACTER
        SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
    -- 密码 最大长度为 255 的字符串
    `password`   VARCHAR(255) CHARACTER
        SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
    -- 创建时间 默认值为当前时间戳
    `created_at` TIMESTAMP                     NULL DEFAULT CURRENT_TIMESTAMP,
    -- 设置主键索引
    PRIMARY KEY (`id`) USING BTREE,
    -- 为 username 列设置唯一索引以确保用户名不重复
    UNIQUE INDEX `username` (`username` ASC) USING BTREE
) ENGINE = INNODB
  AUTO_INCREMENT = 1
  CHARACTER
      SET = utf8mb4
  COLLATE = utf8mb4_0900_ai_ci
  ROW_FORMAT = Dynamic;

-- 删除 bill 表如果它存在
DROP TABLE IF EXISTS `bill`;

-- 创建 bill 表用于存储账单信息
CREATE TABLE `bill`
(
    -- 主键 id 自动递增
    `id`           INT                         NOT NULL AUTO_INCREMENT,
    -- 用户 id 外键关联 user 表
    `user_id`      INT                         NOT NULL,
    -- 账单名称 最大长度为 100 的字符串
    `name`         VARCHAR(100) CHARACTER
        SET utf8mb4 COLLATE utf8mb4_0900_ai_ci NOT NULL,
    -- 消费时间 datetime 类型
    `consume_time` datetime                    NOT NULL,
    -- 消费金额 decimal 类型 精度为 10 小数位为 2
    `amount`       DECIMAL(10, 2)              NOT NULL,
    -- 设置主键索引
    PRIMARY KEY (`id`) USING BTREE,
    -- 为 user_id 列设置索引以提高查询效率
    INDEX `user_id` (`user_id` ASC) USING BTREE,
    -- 设置外键约束 当 user 表中的记录被删除时 受影响的 bill 记录将受到限制
    CONSTRAINT `bill_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `user` (`id`) ON DELETE RESTRICT ON UPDATE RESTRICT
) ENGINE = INNODB
  AUTO_INCREMENT = 1
  CHARACTER
      SET = utf8mb4
  COLLATE = utf8mb4_0900_ai_ci
  ROW_FORMAT = Dynamic;

-- 向 user 表插入初始数据
INSERT INTO `user` (`username`, `password`)
VALUES ('user1', '123456'),
       ('user2', '123456'),
       ('user3', '123456'),
       ('user4', '123456'),
       ('user5', '123456');

-- 向 bill 表插入初始数据
INSERT INTO `bill` (`user_id`, `name`, `consume_time`, `amount`)
VALUES (1, '购物', '2024-12-01 10:00:00', 120.50),
       (1, '电费', '2024-12-02 15:30:00', 80.00),
       (1, '外出就餐', '2024-12-03 19:00:00', 45.75),
       (1, '购买书籍', '2024-12-04 14:30:00', 60.00),
       (1, '互联网费用', '2024-12-05 09:00:00', 35.99),
       (1, '健身房会员费', '2024-12-06 07:00:00', 150.00),
       (1, '电影票', '2024-12-07 21:30:00', 120.00),
       (1, '快餐', '2024-12-08 13:45:00', 35.00),
       (1, '网购鞋子', '2024-12-09 11:00:00', 250.00),
       (1, '餐馆晚餐', '2024-12-10 19:30:00', 180.50),
       (1, '购物', '2024-12-11 10:00:00', 150.00),
       (1, '外出就餐', '2024-12-12 20:00:00', 80.00),
       (1, '网购鞋子', '2024-12-13 14:30:00', 220.00),
       (1, '购物', '2024-12-14 16:00:00', 100.00),
       (1, '家电购买', '2024-12-15 13:00:00', 300.00),
       (1, '电影票', '2024-12-16 18:30:00', 130.00),
       (1, '健身房', '2024-12-17 07:30:00', 160.00),
       (1, '午餐', '2024-12-18 12:00:00', 50.00),
       (1, '晚餐', '2024-12-19 19:00:00', 110.00),
       (1, '网购书籍', '2024-12-20 15:00:00', 75.00),
       (2, '家居用品', '2024-12-11 16:00:00', 90.00),
       (2, '交通费用', '2024-12-12 08:30:00', 30.00),
       (2, '个人护理', '2024-12-13 10:00:00', 60.50),
       (2, '外卖', '2024-12-14 12:00:00', 45.00),
       (2, '订阅服务', '2024-12-15 09:00:00', 20.00),
       (2, '办公用品', '2024-12-16 14:15:00', 80.00),
       (2, '礼品', '2024-12-17 17:45:00', 100.00),
       (2, '旅游费用', '2024-12-18 11:00:00', 300.00),
       (2, '快递费', '2024-12-19 16:00:00', 25.00),
       (2, '健康检查', '2024-12-20 09:30:00', 200.00),
       (2, '家居用品', '2024-12-21 16:00:00', 85.00),
       (2, '外卖', '2024-12-22 12:30:00', 50.00),
       (2, '订阅服务', '2024-12-23 10:00:00', 25.00),
       (2, '购物', '2024-12-24 14:00:00', 100.00),
       (2, '外出就餐', '2024-12-25 19:30:00', 120.00),
       (2, '电影票', '2024-12-26 21:00:00', 70.00),
       (2, '交通费用', '2024-12-27 08:00:00', 40.00),
       (2, '网购', '2024-12-28 13:00:00', 150.00),
       (2, '餐馆消费', '2024-12-29 19:00:00', 90.00),
       (3, '购物', '2024-12-01 11:00:00', 100.00),
       (3, '餐饮', '2024-12-02 13:30:00', 50.00),
       (3, '电影票', '2024-12-03 18:00:00', 75.00),
       (3, '网购', '2024-12-04 10:00:00', 180.00),
       (3, '书籍', '2024-12-05 15:00:00', 40.00),
       (3, '健身', '2024-12-06 07:30:00', 120.00),
       (3, '外出就餐', '2024-12-07 19:00:00', 80.00),
       (3, '订阅服务', '2024-12-08 14:00:00', 25.00),
       (3, '日用品', '2024-12-09 09:30:00', 60.00),
       (3, '休闲娱乐', '2024-12-10 16:30:00', 150.00),
       (3, '外卖', '2024-12-11 12:00:00', 40.00),
       (3, '网购', '2024-12-12 10:30:00', 220.00),
       (3, '健身', '2024-12-13 09:00:00', 130.00),
       (3, '电影票', '2024-12-14 19:30:00', 85.00),
       (3, '外出就餐', '2024-12-15 21:00:00', 60.00),
       (3, '购物', '2024-12-16 14:30:00', 150.00),
       (3, '健身', '2024-12-17 07:30:00', 120.00),
       (3, '晚餐', '2024-12-18 19:30:00', 100.00),
       (3, '电影票', '2024-12-19 16:00:00', 80.00),
       (4, '购买电子产品', '2024-12-01 08:00:00', 200.00),
       (4, '外卖', '2024-12-02 12:30:00', 50.00),
       (4, '书籍', '2024-12-03 11:00:00', 45.00),
       (4, '健身', '2024-12-04 07:00:00', 100.00),
       (4, '旅游费用', '2024-12-05 10:00:00', 300.00),
       (4, '聚会', '2024-12-06 20:00:00', 150.00),
       (4, '交通费用', '2024-12-07 09:30:00', 40.00),
       (4, '健康检查', '2024-12-08 16:00:00', 250.00),
       (4, '餐厅消费', '2024-12-09 18:30:00', 120.00),
       (4, '在线课程', '2024-12-10 13:30:00', 200.00),
       (4, '聚会', '2024-12-11 22:00:00', 180.00),
       (4, '外卖', '2024-12-12 12:30:00', 45.00),
       (4, '健康检查', '2024-12-13 16:00:00', 250.00),
       (4, '旅行费用', '2024-12-14 09:00:00', 320.00),
       (4, '电影票', '2024-12-15 18:00:00', 120.00),
       (4, '购物', '2024-12-16 11:30:00', 140.00),
       (4, '书籍', '2024-12-17 15:00:00', 60.00),
       (4, '餐馆消费', '2024-12-18 19:30:00', 100.00),
       (5, '日常用品', '2024-12-01 10:30:00', 30.00),
       (5, '快餐', '2024-12-02 12:15:00', 35.00),
       (5, '购物', '2024-12-03 14:00:00', 80.00),
       (5, '电影票', '2024-12-04 17:30:00', 120.00),
       (5, '咖啡', '2024-12-05 09:00:00', 20.00),
       (5, '网购', '2024-12-06 11:45:00', 150.00),
       (5, '外卖', '2024-12-07 13:30:00', 60.00),
       (5, '书籍', '2024-12-08 15:00:00', 45.00),
       (5, '交通费用', '2024-12-09 09:30:00', 25.00),
       (5, '餐馆消费', '2024-12-10 19:00:00', 90.00),
       (5, '外卖', '2024-12-11 14:30:00', 55.00),
       (5, '网购', '2024-12-12 16:00:00', 170.00),
       (5, '电影票', '2024-12-13 18:30:00', 100.00),
       (5, '购物', '2024-12-14 12:00:00', 140.00),
       (5, '书籍', '2024-12-15 13:00:00', 60.00),
       (5, '交通费用', '2024-12-16 09:30:00', 30.00),
       (5, '咖啡', '2024-12-17 16:30:00', 25.00),
       (5, '晚餐', '2024-12-18 19:00:00', 80.00);

-- 重新启用外键检查以确保数据完整性
SET FOREIGN_KEY_CHECKS = 1;